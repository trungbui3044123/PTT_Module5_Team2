<!doctype html>
<html lang="vi">
<head>
    <meta charset="UTF-8"/>
    <title>Danh sách người dùng</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }

        .title {
            text-align: center;
            margin-bottom: 20px;
        }

        .toolbar {
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
        }

        #userTable {
            width: 100%;
            border-collapse: collapse;
            background: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        #userTable th,
        #userTable td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: left;
        }

        #userTable th {
            background: #007bff;
            color: white;
        }

        #userTable tr:nth-child(even) {
            background: #f2f2f2;
        }

        #userTable tr:hover {
            background: #e6f3ff;
        }

        #pagination {
            margin-top: 15px;
        }

        #pagination button {
            margin-right: 5px;
            padding: 5px 10px;
        }

        .active-page {
            font-weight: bold;
            background: #007bff;
            color: white;
        }
    </style>
</head>
<body>
<div><br><br>
    <button id="homePage">Back Home page</button>
</div>
<h2 class="title">Danh sách người dùng</h2>

<div class="toolbar">
    <input type="text" id="keyword" placeholder="Tìm theo tên / email..."/>
    <button id="searchBtn">Tìm</button>

    <select id="sortField">
        <option value="id">ID</option>
        <option value="username">Username</option>
        <option value="email">Email</option>
        <option value="status">Status</option>
        <option value="age">Age</option>
        <option value="salary">Salary</option>
    </select>

    <select id="sortDir">
        <option value="asc">Tăng dần</option>
        <option value="desc">Giảm dần</option>
    </select>
</div>

<table id="userTable">
    <thead>
    <tr>
        <th>ID</th>
        <th>Username</th>
        <th>Email</th>
        <th>Phone</th>
        <th>Name</th>
        <th>Age</th>
        <th>Address</th>
        <th>Role</th>
        <th>Status</th>
        <th>Salary(VND)</th>
    </tr>
    </thead>
    <tbody id="userBody">
    <!-- JS sẽ render vào đây -->
    </tbody>
</table>

<div id="pagination"></div>

<script>
    const token = localStorage.getItem("token");

    if (!token) {
        window.location.href = "./Login.html";
    }
    const tbody = document.getElementById("userBody");
    const pagination = document.getElementById("pagination");

    let currentPage = 0;
    const pageSize = 5;

    function renderUsers(users) {
        tbody.innerHTML = "";
        users.forEach((u) => {
            const row = ` <tr> <td>${u.id}</td> <td>${u.username}</td> <td>${u.email}</td> <td>${u.phone}</td> <td>${u.name}</td> <td>${u.age}</td> <td>${u.address}</td> <td>${u.role}</td> <td>${u.status}</td> <td>${u.role === "STAFF" ? u.salary : "-"}</td> </tr> `;
            tbody.innerHTML += row;
        });
    }

    function renderPagination(data) {
        pagination.innerHTML = "";

        if (!data.first) {
            pagination.innerHTML += `<button onclick="loadUsers(${currentPage - 1})">Prev</button>`;
        }

        for (let i = 0; i < data.totalPages; i++) {
            pagination.innerHTML += `<button class="${i === data.number ? "active-page" : ""}" onclick="loadUsers(${i})">
              ${i + 1}
            </button>
          `;
        }

        if (!data.last) {
            pagination.innerHTML += `<button onclick="loadUsers(${currentPage + 1})">Next</button>`;
        }
    }

    function loadUsers(page = 0) {
        const keyword = document.getElementById("keyword").value;
        const sortField = document.getElementById("sortField").value;
        const sortDir = document.getElementById("sortDir").value;

        fetch(
            `http://localhost:8080/api/admin/users?page=${page}&size=${pageSize}&sort=${sortField},${sortDir}&keyword=${keyword}`,
            {
                headers: {
                    "Content-Type": "application/json",
                    Authorization: "Bearer " + token,
                },
            }
        )
            .then((res) => res.json())
            .then((result) => {
                if (result.status === 200) {
                    currentPage = page;
                    renderUsers(result.data.content);
                    renderPagination(result.data);
                }
            });
    }



    // fetch("http://localhost:8080/api/admin/users", {
    //     method: "GET",
    //     headers: {
    //         "Content-Type": "application/json",
    //         "Authorization": "Bearer " + token
    //     }
    // })
    //     .then(res => res.json())
    //     .then(result => {
    //         if (result.status === 200) {
    //             renderUsers(result.data.content);
    //
    //         } else {
    //             const error = document.createElement("h3")
    //             error.innerHTML = "No data ";
    //             tbody.appendChild(error);
    //         }
    //
    //     })

    document.getElementById("searchBtn").addEventListener("click", () => {
        loadUsers(0);
    });

    document
        .getElementById("sortField")
        .addEventListener("change", () => loadUsers(0));
    document
        .getElementById("sortDir")
        .addEventListener("change", () => loadUsers(0));

    document.getElementById("homePage").addEventListener("click", function (e) {
        e.preventDefault();
        window.location.href = "./Dashboard.html";
    })

    loadUsers(0);
</script>
</body>
</html>
